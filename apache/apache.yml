- hosts: localhost
  connection: local
  sudo: True
  vars:
    plugins_path: "/etc/amonagent/plugins/apache"
    enabled_plugins: "/etc/amonagent/plugins-enabled"
    name: "apache"
    status_url: "http://127.0.0.1/server_status"
  tasks:
  - 
    name: Apache | Enable mod_status
    command: a2enmod status
    when: ansible_os_family == "Debian"
  - 
    name: Copy the plugin configuration file 
    template: src={{ plugins_path }}/{{ name }}.conf.example dest={{ enabled_plugins }}/{{ name }}.conf
  - 
    template: src={{ plugins_path }}/status_template dest=/etc/apache2/mods-enabled/status.conf
    when: ansible_os_family == "Debian"
  -
    service: name=apache2 state=restarted
    when: ansible_os_family == "Debian"
  - 
    template: src={{ plugins_path }}/status_template dest=/etc/httpd/conf.d/status.conf
    when: ansible_os_family == "RedHat"
  -
    service: name=httpd state=restarted
    when: ansible_os_family == "RedHat"