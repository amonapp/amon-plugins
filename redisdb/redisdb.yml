- hosts: localhost
  connection: local
  vars:
    plugins_path: "/etc/amonagent/plugins/redisdb"
    enabled_plugins: "/etc/amonagent/plugins-enabled"
    name: "redisdb"
    url: "redis://localhost:6379/0"
  # vars_prompt:
  # - name: "url"
  #   prompt: "Please enter your Redis connection string (Example: redis://localhost:6379/0)"
  #   when: amonenv is not defined
  tasks:
  - template: src={{ plugins_path }}/{{ name }}.conf.example dest={{ enabled_plugins }}/{{ name }}.conf
  - name: Install Plugin requirements
    pip: requirements={{ plugins_path }}/requirements.txt
  - name: Restart the agent
    command: /etc/init.d/amon-agent restart
  - name: Start redis 
    command: service redis-server start
  - name: Test the plugins
    command: /etc/init.d/amon-agent test_plugins